#!/bin/bash
set -eu -o pipefail

force=false

case ${1:-} in
	-f|--force)
		force=true
		shift
	;;
esac

container=${1:-}
shift

run=false

if [[ -n $container ]]; then
	if [[ $(docker container inspect --format '{{.State.Status}}' "$container" 2>/dev/null) == running ]]; then
		echo "stopping container '$container'..."
		docker container stop --time=60 "$container" >/dev/null
		run=true
	elif [[ $force != true ]]; then
		echo "error: the specified container '$container' is not running" >&2
		exit 1
	fi
fi

"$@"

if [[ -n $container ]] && [[ $run == true ]]; then
	echo "starting container '$container'..."
	docker container start "$container" >/dev/null
fi
